## 程序说明

本程序支持E河海App打卡接口和信息门户打卡接口，可根据情况自动选择合适的打卡接口，比其他版本的自动打卡系统更加稳定；

支持自动解析上次打卡内容，无需额外配置打卡信息，即可自动完成打卡；

支持腾讯云函数，阿里云云函数，Github Actions，服务器部署等部署方式，实现无人值守自动打卡。

支持一个脚本为多名同学打卡

支持将打卡情况以邮件的形式通知被打卡人

## 运行环境

python 3.6+

## 更新日志
[2022/08/25] 2.0.1

1.修复学生身份识别错误的bug

[2021/09/07] 2.0(重大更新)

1.代码重构，减少代码冗余

2.新增研究生自动打卡功能（理论可用，未严格测试）[感谢某位研究生学长的支持]

3.新增发信功能

4.支持同时为多个同学打卡

5.规范日志记录格式和错误检测

[2021/09/07] 1.3

由于新接口dailyreport.hhu.edu.cn不支持弱密码，故新增弱密码检测，若密码为纯数字，默认使用老接口进行打卡。

修复老接口form.hhu.edu.cn在部分环境下出现Cookie丢失的Bug。

将Crypto包修改为cryptography，便于安装。

将时区固定为GMT +8，避免部分环境下因日期获取错误导致的打卡失败。

[2021/09/06] 1.2

由于form.hhu.edu.cn外网访问不稳定，故新增dailyreport.hhu.edu.cn打卡接口。

目前逻辑如下：

优先使用dailyreport.hhu.edu.cn打卡，若dailyreport.hhu.edu.cn需要验证码登录，则使用form.hhu.edu.cn打卡

[2021/09/03] 1.1

修正了因学校打卡系统修改打卡字段而导致程序崩溃的Bug

[2021/08/25] 1.0

第一版上线，较以往版本修改登录接口，新增解析打卡内容功能


## 部署教程

### 服务器部署

1.按提示修改report.py第18行到第40行的用户信息（如果不需要发信功能，请一定不要添加email字段！！！）

2.运行`pip install -r requirements.txt`安装依赖

2.使用crontab添加定时任务，定时调用`python report.py`即可

### 腾讯云函数部署（推荐）

1.按提示修改report.py第18行到第40行的用户信息（如果不需要发信功能，请一定不要添加email字段！！！）

2.进入 https://console.cloud.tencent.com/scf/list 创建一个云函数。

创建时请选择自定义创建，函数类型选择事件函数，地域建议选择上海，运行环境建议选择Python3.6，函数代码部分将report.py修改好的内容复制进去，其他选项保持默认，点击完成。

3.在函数管理 - 函数配置中，修改函数执行超时时间为300秒。（学校服务器有时会抽风）

![](https://s3.bmp.ovh/imgs/2021/09/0780506568bb57ff.png)

4.在函数管理 - 函数代码中，点击编辑器菜单栏的终端 - 新终端，在弹出的命令行中依次输入

```
cd src
pip3 install requests_html -t .
```
安装依赖完成后，点击部署，将其部署在云中。

![](https://s3.bmp.ovh/imgs/2021/09/1ff9367bf1b23e00.png)

![](https://s3.bmp.ovh/imgs/2021/09/1c754d57a5110b21.png)

![](https://s3.bmp.ovh/imgs/2021/09/aa624c1fadaeb612.png)

5.在触发管理中，创建触发器。触发周期选择自定义触发，填入crontab表达式即可。

常用crontab表达式

```
0 0 6 * * * *       #每天6点触发
0 30 6 * * * *      #每天6点半触发
0 0 7 * * * *       #每天7点触发
```
